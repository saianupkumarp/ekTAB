import { Component, OnInit } from '@angular/core';
import { ElectronService } from 'ngx-electron';
import { RestService } from '../rest.service';
import { ActivatedRoute, Router } from '@angular/router';
import { ButtonsModule } from 'ngx-bootstrap/buttons';

declare let d3: any;

@Component({
  selector: 'app-dashboard',
  templateUrl: './dashboard.component.html',
  styleUrls: ['./dashboard.component.scss', '../../../node_modules/nvd3/build/nv.d3.css']
})
export class DashboardComponent implements OnInit {

  folder: string[];
  status: string[];
  loadingMessage: any;
  errorMessage: any;
  noUiSlider: any;
  LineChartOptions: any;
  Linedata: any;

  constructor(private _electronService: ElectronService, public rest:RestService, private route: ActivatedRoute, private router: Router) { }

  ngOnInit() {
    this.getLineChart();
    this.getServerStatus();
  }

  getServerStatus() {
    this.rest.getLineChartData().subscribe((data) => {
      console.log(data);
      this.status = data;
    });
  }

  getLineChart() {
    this.loadingMessage = true;

    this.rest.getLineChartData().subscribe((data) => {
      console.log(data);
      this.LineChartOptions = {
        chart: {
          type: 'lineChart',
          useInteractiveGuideline: true,
          height: 450,
          transitionDuration: 350,
          showLegend: false,
          margin: {
            top: 20,
            right: 20,
            bottom: 40,
            left: 55
          },
          x: (d) => { return d.x; },
          y: (d) => { return d.y; },
          xScale: d3.time.scale(),
          xAxis: {
            ticks: d3.time.months,
            tickFormat: (d) => {
                return d3.time.format('%b')(new Date(d));
            }
          },
          yAxis: {
            axisLabel: 'Gross volume',
            tickFormat: (d) => {
                if (d == null) {
                    return 0;
                }
                return d3.format('.02f')(d);
            },
            axisLabelDistance: 400
          }
        }
      };
      this.Linedata = [{"values":[{"x":0,"y":0,"series":0},{"x":1,"y":0.09983341664682815,"series":0},{"x":2,"y":0.19866933079506122,"series":0},{"x":3,"y":0.29552020666133955,"series":0},{"x":4,"y":0.3894183423086505,"series":0},{"x":5,"y":0.479425538604203,"series":0},{"x":6,"y":0.5646424733950354,"series":0},{"x":7,"y":0.644217687237691,"series":0},{"x":8,"y":0.7173560908995228,"series":0},{"x":9,"y":0.7833269096274834,"series":0},{"x":10,"y":0.8414709848078965,"series":0},{"x":11,"y":0.8912073600614354,"series":0},{"x":12,"y":0.9320390859672263,"series":0},{"x":13,"y":0.963558185417193,"series":0},{"x":14,"y":0.9854497299884601,"series":0},{"x":15,"y":0.9974949866040544,"series":0},{"x":16,"y":0.9995736030415051,"series":0},{"x":17,"y":0.9916648104524686,"series":0},{"x":18,"y":0.9738476308781951,"series":0},{"x":19,"y":0.9463000876874145,"series":0},{"x":20,"y":0.9092974268256817,"series":0},{"x":21,"y":0.8632093666488737,"series":0},{"x":22,"y":0.8084964038195901,"series":0},{"x":23,"y":0.7457052121767203,"series":0},{"x":24,"y":0.675463180551151,"series":0},{"x":25,"y":0.5984721441039564,"series":0},{"x":26,"y":0.5155013718214642,"series":0},{"x":27,"y":0.4273798802338298,"series":0},{"x":28,"y":0.3349881501559051,"series":0},{"x":29,"y":0.23924932921398243,"series":0},{"x":30,"y":0.1411200080598672,"series":0},{"x":31,"y":0.04158066243329049,"series":0},{"x":32,"y":-0.058374143427580086,"series":0},{"x":33,"y":-0.1577456941432482,"series":0},{"x":34,"y":-0.2555411020268312,"series":0},{"x":35,"y":-0.35078322768961984,"series":0},{"x":36,"y":-0.44252044329485246,"series":0},{"x":37,"y":-0.5298361409084934,"series":0},{"x":38,"y":-0.6118578909427189,"series":0},{"x":39,"y":-0.6877661591839738,"series":0},{"x":40,"y":-0.7568024953079282,"series":0},{"x":41,"y":-0.8182771110644103,"series":0},{"x":42,"y":-0.8715757724135882,"series":0},{"x":43,"y":-0.9161659367494549,"series":0},{"x":44,"y":-0.9516020738895161,"series":0},{"x":45,"y":-0.977530117665097,"series":0},{"x":46,"y":-0.9936910036334644,"series":0},{"x":47,"y":-0.9999232575641008,"series":0},{"x":48,"y":-0.9961646088358407,"series":0},{"x":49,"y":-0.9824526126243325,"series":0},{"x":50,"y":-0.9589242746631385,"series":0},{"x":51,"y":-0.9258146823277325,"series":0},{"x":52,"y":-0.8834546557201531,"series":0},{"x":53,"y":-0.8322674422239013,"series":0},{"x":54,"y":-0.7727644875559871,"series":0},{"x":55,"y":-0.7055403255703919,"series":0},{"x":56,"y":-0.6312666378723216,"series":0},{"x":57,"y":-0.5506855425976376,"series":0},{"x":58,"y":-0.46460217941375737,"series":0},{"x":59,"y":-0.373876664830236,"series":0},{"x":60,"y":-0.27941549819892586,"series":0},{"x":61,"y":-0.18216250427209588,"series":0},{"x":62,"y":-0.0830894028174964,"series":0},{"x":63,"y":0.016813900484349713,"series":0},{"x":64,"y":0.11654920485049364,"series":0},{"x":65,"y":0.21511998808781552,"series":0},{"x":66,"y":0.31154136351337786,"series":0},{"x":67,"y":0.4048499206165983,"series":0},{"x":68,"y":0.49411335113860816,"series":0},{"x":69,"y":0.5784397643882002,"series":0},{"x":70,"y":0.6569865987187891,"series":0},{"x":71,"y":0.7289690401258759,"series":0},{"x":72,"y":0.7936678638491532,"series":0},{"x":73,"y":0.8504366206285644,"series":0},{"x":74,"y":0.8987080958116269,"series":0},{"x":75,"y":0.9379999767747389,"series":0},{"x":76,"y":0.9679196720314863,"series":0},{"x":77,"y":0.9881682338770004,"series":0},{"x":78,"y":0.998543345374605,"series":0},{"x":79,"y":0.998941341839772,"series":0},{"x":80,"y":0.9893582466233818,"series":0},{"x":81,"y":0.9698898108450863,"series":0},{"x":82,"y":0.9407305566797731,"series":0},{"x":83,"y":0.9021718337562934,"series":0},{"x":84,"y":0.8545989080882805,"series":0},{"x":85,"y":0.7984871126234903,"series":0},{"x":86,"y":0.7343970978741134,"series":0},{"x":87,"y":0.6629692300821833,"series":0},{"x":88,"y":0.5849171928917617,"series":0},{"x":89,"y":0.5010208564578846,"series":0},{"x":90,"y":0.4121184852417566,"series":0},{"x":91,"y":0.3190983623493521,"series":0},{"x":92,"y":0.22288991410024764,"series":0},{"x":93,"y":0.1244544235070617,"series":0},{"x":94,"y":0.024775425453357765,"series":0},{"x":95,"y":-0.0751511204618093,"series":0},{"x":96,"y":-0.17432678122297965,"series":0},{"x":97,"y":-0.27176062641094245,"series":0},{"x":98,"y":-0.3664791292519284,"series":0},{"x":99,"y":-0.4575358937753214,"series":0}],"key":"Sine Wave","color":"#ff7f0e","strokeWidth":2,"classed":"dashed"},{"values":[{"x":0,"y":-0.19842590634673324,"series":1},{"x":1,"y":-0.23322357605660457,"series":1},{"x":2,"y":-0.20804296664582111,"series":1},{"x":3,"y":-0.2530208907652797,"series":1},{"x":4,"y":-0.3619976890625403,"series":1},{"x":5,"y":-0.33702417872222634,"series":1},{"x":6,"y":-0.33076262439043747,"series":1},{"x":7,"y":-0.41817518425653966,"series":1},{"x":8,"y":-0.41489726526144416,"series":1},{"x":9,"y":-0.4710451503773147,"series":1},{"x":10,"y":-0.40115868483334216,"series":1},{"x":11,"y":-0.48684820674813656,"series":1},{"x":12,"y":-0.41156256822915427,"series":1},{"x":13,"y":-0.476669091824661,"series":1},{"x":14,"y":-0.422989987687664,"series":1},{"x":15,"y":-0.41910974376039517,"series":1},{"x":16,"y":-0.44100682934065366,"series":1},{"x":17,"y":-0.41137986475488403,"series":1},{"x":18,"y":-0.32500371757403823,"series":1},{"x":19,"y":-0.3295617093619001,"series":1},{"x":20,"y":-0.30384498452231784,"series":1},{"x":21,"y":-0.25783124730801493,"series":1},{"x":22,"y":-0.18741230195186953,"series":1},{"x":23,"y":-0.19746811189196414,"series":1},{"x":24,"y":-0.1513541971426997,"series":1},{"x":25,"y":-0.011219438271378682,"series":1},{"x":26,"y":0.0008103307778525026,"series":1},{"x":27,"y":0.04288227446703574,"series":1},{"x":28,"y":0.0735300181904764,"series":1},{"x":29,"y":0.11724983241269746,"series":1},{"x":30,"y":0.23716668978168187,"series":1},{"x":31,"y":0.23086455125525657,"series":1},{"x":32,"y":0.2777371218713067,"series":1},{"x":33,"y":0.28295745848671544,"series":1},{"x":34,"y":0.34096266091521166,"series":1},{"x":35,"y":0.3994651072579949,"series":1},{"x":36,"y":0.39047120750639636,"series":1},{"x":37,"y":0.42922697235532303,"series":1},{"x":38,"y":0.5284039650495232,"series":1},{"x":39,"y":0.5091319514851433,"series":1},{"x":40,"y":0.5256607961393869,"series":1},{"x":41,"y":0.5609965698228946,"series":1},{"x":42,"y":0.5374117096216006,"series":1},{"x":43,"y":0.533350351820696,"series":1},{"x":44,"y":0.5815719447360195,"series":1},{"x":45,"y":0.5116230317011196,"series":1},{"x":46,"y":0.5388438328264731,"series":1},{"x":47,"y":0.5344408193408677,"series":1},{"x":48,"y":0.4863792133219891,"series":1},{"x":49,"y":0.469947569091326,"series":1},{"x":50,"y":0.38718735470895554,"series":1},{"x":51,"y":0.3630894530541057,"series":1},{"x":52,"y":0.3291829580658105,"series":1},{"x":53,"y":0.3085098547834057,"series":1},{"x":54,"y":0.29838528749988447,"series":1},{"x":55,"y":0.18969758261976138,"series":1},{"x":56,"y":0.16001736354544596,"series":1},{"x":57,"y":0.09446791876892895,"series":1},{"x":58,"y":0.0968265192703969,"series":1},{"x":59,"y":0.005370269391660371,"series":1},{"x":60,"y":-0.05257009207704989,"series":1},{"x":61,"y":-0.1057028753868682,"series":1},{"x":62,"y":-0.14542743857786483,"series":1},{"x":63,"y":-0.1774747825398606,"series":1},{"x":64,"y":-0.18121013669914166,"series":1},{"x":65,"y":-0.23169619603697247,"series":1},{"x":66,"y":-0.32712080110818587,"series":1},{"x":67,"y":-0.3726273481420708,"series":1},{"x":68,"y":-0.38135566211237,"series":1},{"x":69,"y":-0.42172033133108894,"series":1},{"x":70,"y":-0.3648314861311994,"series":1},{"x":71,"y":-0.4613921659822273,"series":1},{"x":72,"y":-0.47333127473802183,"series":1},{"x":73,"y":-0.4311679470340663,"series":1},{"x":74,"y":-0.49624062425138005,"series":1},{"x":75,"y":-0.4462960179763171,"series":1},{"x":76,"y":-0.44187247835495724,"series":1},{"x":77,"y":-0.4089405526472709,"series":1},{"x":78,"y":-0.44582429307855026,"series":1},{"x":79,"y":-0.3963657991448698,"series":1},{"x":80,"y":-0.41890146032337183,"series":1},{"x":81,"y":-0.32894409295992555,"series":1},{"x":82,"y":-0.2742554966167522,"series":1},{"x":83,"y":-0.23124925361579685,"series":1},{"x":84,"y":-0.24920396532910707,"series":1},{"x":85,"y":-0.14543473778471508,"series":1},{"x":86,"y":-0.10559289173628557,"series":1},{"x":87,"y":-0.11733122485982413,"series":1},{"x":88,"y":-0.05939147565593274,"series":1},{"x":89,"y":-0.04345289446566624,"series":1},{"x":90,"y":0.0476091426204961,"series":1},{"x":91,"y":0.13013380251512802,"series":1},{"x":92,"y":0.13118862025539565,"series":1},{"x":93,"y":0.1593977034279895,"series":1},{"x":94,"y":0.24793019249010356,"series":1},{"x":95,"y":0.24498540647314052,"series":1},{"x":96,"y":0.3470890860497635,"series":1},{"x":97,"y":0.3823810264071131,"series":1},{"x":98,"y":0.3726362282256165,"series":1},{"x":99,"y":0.4849727660949069,"series":1}],"key":"Cosine Wave","color":"#2ca02c"},{"values":[{"x":0,"y":0.5,"series":2},{"x":1,"y":0.524958354161707,"series":2},{"x":2,"y":0.5496673326987653,"series":2},{"x":3,"y":0.5738800516653348,"series":2},{"x":4,"y":0.5973545855771626,"series":2},{"x":5,"y":null,"series":2},{"x":6,"y":0.6411606183487588,"series":2},{"x":7,"y":0.6610544218094228,"series":2},{"x":8,"y":0.6793390227248807,"series":2},{"x":9,"y":0.6958317274068708,"series":2},{"x":10,"y":0.7103677462019742,"series":2},{"x":11,"y":0.7228018400153589,"series":2},{"x":12,"y":0.7330097714918066,"series":2},{"x":13,"y":0.7408895463542983,"series":2},{"x":14,"y":0.746362432497115,"series":2},{"x":15,"y":null,"series":2},{"x":16,"y":0.7498934007603762,"series":2},{"x":17,"y":0.7479162026131172,"series":2},{"x":18,"y":0.7434619077195488,"series":2},{"x":19,"y":0.7365750219218536,"series":2},{"x":20,"y":0.7273243567064205,"series":2},{"x":21,"y":0.7158023416622185,"series":2},{"x":22,"y":0.7021241009548975,"series":2},{"x":23,"y":0.6864263030441801,"series":2},{"x":24,"y":0.6688657951377878,"series":2},{"x":25,"y":null,"series":2},{"x":26,"y":0.6288753429553661,"series":2},{"x":27,"y":0.6068449700584575,"series":2},{"x":28,"y":0.5837470375389763,"series":2},{"x":29,"y":0.5598123323034956,"series":2},{"x":30,"y":0.5352800020149668,"series":2},{"x":31,"y":0.5103951656083227,"series":2},{"x":32,"y":0.48540646414310495,"series":2},{"x":33,"y":0.46056357646418794,"series":2},{"x":34,"y":0.4361147244932922,"series":2},{"x":35,"y":null,"series":2},{"x":36,"y":0.3893698891762869,"series":2},{"x":37,"y":0.3675409647728767,"series":2},{"x":38,"y":0.3470355272643203,"series":2},{"x":39,"y":0.32805846020400653,"series":2},{"x":40,"y":0.31079937617301795,"series":2},{"x":41,"y":0.29543072223389744,"series":2},{"x":42,"y":0.28210605689660295,"series":2},{"x":43,"y":0.2709585158126363,"series":2},{"x":44,"y":0.26209948152762097,"series":2},{"x":45,"y":null,"series":2},{"x":46,"y":0.2515772490916339,"series":2},{"x":47,"y":0.2500191856089748,"series":2},{"x":48,"y":0.25095884779103983,"series":2},{"x":49,"y":0.2543868468439169,"series":2},{"x":50,"y":0.26026893133421536,"series":2},{"x":51,"y":0.2685463294180669,"series":2},{"x":52,"y":0.2791363360699617,"series":2},{"x":53,"y":0.29193313944402466,"series":2},{"x":54,"y":0.3068088781110032,"series":2},{"x":55,"y":null,"series":2},{"x":56,"y":0.34218334053191957,"series":2},{"x":57,"y":0.3623286143505906,"series":2},{"x":58,"y":0.38384945514656066,"series":2},{"x":59,"y":0.406530833792441,"series":2},{"x":60,"y":0.43014612545026853,"series":2},{"x":61,"y":0.45445937393197605,"series":2},{"x":62,"y":0.4792276492956259,"series":2},{"x":63,"y":0.5042034751210874,"series":2},{"x":64,"y":0.5291373012126234,"series":2},{"x":65,"y":null,"series":2},{"x":66,"y":0.5778853408783444,"series":2},{"x":67,"y":0.6012124801541496,"series":2},{"x":68,"y":0.623528337784652,"series":2},{"x":69,"y":0.64460994109705,"series":2},{"x":70,"y":0.6642466496796973,"series":2},{"x":71,"y":0.682242260031469,"series":2},{"x":72,"y":0.6984169659622883,"series":2},{"x":73,"y":0.7126091551571411,"series":2},{"x":74,"y":0.7246770239529068,"series":2},{"x":75,"y":null,"series":2},{"x":76,"y":0.7419799180078716,"series":2},{"x":77,"y":0.7470420584692501,"series":2},{"x":78,"y":0.7496358363436513,"series":2},{"x":79,"y":0.749735335459943,"series":2},{"x":80,"y":0.7473395616558455,"series":2},{"x":81,"y":0.7424724527112716,"series":2},{"x":82,"y":0.7351826391699433,"series":2},{"x":83,"y":0.7255429584390733,"series":2},{"x":84,"y":0.7136497270220701,"series":2},{"x":85,"y":null,"series":2},{"x":86,"y":0.6835992744685284,"series":2},{"x":87,"y":0.6657423075205459,"series":2},{"x":88,"y":0.6462292982229404,"series":2},{"x":89,"y":0.6252552141144712,"series":2},{"x":90,"y":0.6030296213104391,"series":2},{"x":91,"y":0.579774590587338,"series":2},{"x":92,"y":0.555722478525062,"series":2},{"x":93,"y":0.5311136058767654,"series":2},{"x":94,"y":0.5061938563633395,"series":2},{"x":95,"y":null,"series":2},{"x":96,"y":0.4564183046942551,"series":2},{"x":97,"y":0.4320598433972644,"series":2},{"x":98,"y":0.40838021768701793,"series":2},{"x":99,"y":0.38561602655616967,"series":2}],"key":"Another sine wave","color":"#7777ff","area":true}] ;
      this.loadingMessage = false;
    },
    (err: any) => {
      this.errorMessage = "There are no posts pulled from the server!";
      this.loadingMessage = false;
    });
  }

  openDialog(){
    console.log("function called");
    this._electronService.remote.dialog.showOpenDialog({title: 'Select a folder', properties: ['openFile']}, (db_file) => {
      if (db_file === undefined){
          console.log("You didn't select a folder");
          return;
      } else {
        console.log(db_file[0])
        console.log(db_file);
      }      
    });
  }

}
